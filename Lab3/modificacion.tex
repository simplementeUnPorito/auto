\subsection{Modificación de la Dinámica de la Planta}
\subsubsection{Diseñar un compensador que logre un margen de fase de $60^\circ$} 

Para el diseño, en primer lugar se transforma la planta del plano $\mathcal{S}$ al plano $\mathcal{Z}$, y posteriormente al plano $\mathcal{W}$. La primera transformación se realiza empleando la relación presentada en la ecuación~\ref{eq:RelacionGen}.  

Luego, para pasar del plano $\mathcal{Z}$ al plano $\mathcal{W}$, se utiliza la relación de Tustin, expresada en la ecuación~\ref{eq:planoZ}, tal como se explicó en el ítem anterior (\ref{sec:disc}).

\textbf{Diseño de compensadores – análisis preliminar:}  

En primer lugar, se analizan los márgenes de fase y de ganancia de la planta sin compensar.

\insertarfigura{./img/C1_Lead/margenesPlanta.png}{Diagrama de Bode de la planta sin compensación.}{fig:bodeMatlabSinComp}{1}

Se observa que el margen inicial de ganancia es de \SI{31.4}{dB}, lo que permite incrementar el valor de la ganancia $K$.  

\paragraph{Primer intento – Compensador Lead}  

Por criterio de diseño, se selecciona un margen de ganancia aceptable, correspondiente a valores superiores a \SI{10}{dB}. A partir de esta condición se calcula la ganancia:
\[
|G(\omega)| = 20 \log(K) = 31.4 - 10 
\;\;\Rightarrow\;\; K = 10^{21.4/20}.
\]

La nueva ganancia resulta:
\[
K = 11.149.
\]

Con este valor de ganancia se obtiene el siguiente diagrama de Bode:

\insertarfigura{./img/C1_Lead/margenesConK}{Diagrama de Bode de la planta con la nueva ganancia.}{fig:bodenuevak}{1}

En la figura~\ref{fig:bodenuevak} se aprecia el desplazamiento producido por la nueva ganancia $K = 11.7057$, con los siguientes resultados:
\begin{itemize}
	\item \textbf{Margen de ganancia:} $GM = \SI{10.00}{dB}$
	\item \textbf{Margen de fase:} $PM = 41.13^\circ$
	\item \textbf{Frecuencia de cruce de ganancia:} $\omega_{cg} = 1.2 \times 10^3$
	\item \textbf{Frecuencia de cruce de fase:} $\omega_{cp} = 523$
\end{itemize}

Se observa que el margen de fase obtenido es $PM = 41.13^\circ$, lo que representa una diferencia respecto al valor solicitado de $60^\circ$:
\[
\Delta PM = 60^\circ - 41.13^\circ = 18.87^\circ \approx 20^\circ.
\]

Denominamos a este valor $\phi$. Como aún faltan aproximadamente $20^\circ$ para alcanzar el margen de fase deseado, se decide emplear un compensador de adelanto (Lead).  

Conociendo la frecuencia de cruce actual $\omega_{cp,\text{now}}$ y la fase adicional requerida ($\phi \approx 20^\circ$), se procede al diseño del compensador, implementando las siguientes ecuaciones en \textsc{Matlab}:
\[
\alpha = \frac{1 - \sin(\phi)}{1 + \sin(\phi)}, 
\qquad 
T = \frac{1}{\omega_{cp,\text{now}} \sqrt{\alpha}} 
\]
\[
C_0 = \frac{1 + T s}{1 + \alpha T s}, 
\qquad 
g = \frac{1}{\left| G(j\omega_c) C_0(j\omega_c) \right|}
\]
\[
C = g \cdot C_0
\]

\insertarfigura{./img/C1_Lead/margenConC1}{Diagrama de Bode con el primer compensador diseñado.}{fig:bodeConC1}{1}

Los nuevos resultados obtenidos con este compensador son los siguientes:
\begin{itemize}
	\item \textbf{Margen de ganancia:} $GM = \SI{10.83}{dB}$
	\item \textbf{Margen de fase:} $PM = 61.12^\circ$
	\item \textbf{Frecuencia de cruce de ganancia:} $\omega_{cg} = 1.57 \times 10^3$
	\item \textbf{Frecuencia de cruce de fase:} $\omega_{cp} = 523$
\end{itemize}

\textbf{Datos del compensador:} El compensador obtenido puede expresarse de distintas formas.  

\textbf{Forma explícita con todos los decimales}  
\[
C(z) = \frac{1.18473440049107 \, z - 0.737363460561365}{z - 0.374311732736374}
\]

\textbf{Forma explícita con decimales redondeados}  
\[
C_1(z) = \frac{1.185 \, z - 0.7374}{z - 0.3743}
\]

El período de muestreo asociado es:
\[
T_s = 0.001245213061220 \; \text{s}
\]

\textbf{Forma cero-polo-ganancia (ZPK)}

\textbf{Con redondeo:}  
\[
C_1(z) = 1.1847 \cdot \frac{(z - 0.6224)}{(z - 0.3743)}
\]

\textbf{Con todos los decimales:}  
\[
C(z) = 1.184734400491065 \cdot \frac{(z - 0.622387144541200)}{(z - 0.374311732736374)}
\]

\noindent
donde los parámetros identificados son:
\begin{itemize}
	\item Cero: $Z = 0.622387144541200$
	\item Polo: $P = 0.374311732736374$
	\item Ganancia: $K = 1.184734400491065$
	\item Sample time: $t_s = 0.0012452 s$
\end{itemize}

\insertarfigura{./img/C1_Lead/bodeC1}{Diagrama de Bode del primer compensador diseñado.}{fig:bodeC1}{1}

\insertarfigura{./img/C1_Lead/esfuerzoC1}{Esfuerzo del primer compensador diseñado.}{fig:esfuerzoC1}{1}

\insertarfigura{./img/C1_Lead/stepC1}{El step del primer compensador diseñado.}{fig:stepC1}{1}

El resultado obtenido para este diseño no es el más óptimo. Con una ganancia $K = 1.18$, el sistema presenta un error significativo debido a que es de tipo $0$. Al aplicar una entrada escalón, el error en estado estacionario calculado es:
\[
e = \frac{1}{1+K_p} = 45.8\%.
\]

Este valor resulta demasiado elevado. Además, al observar la figura~\ref{fig:esfuerzoC1}, se aprecia que el esfuerzo de control presenta saturación tanto al inicio como al final de la respuesta.  

\paragraph{Segundo intento – Compensador Proporcional}  

A partir del análisis del diagrama de Bode de la planta sin compensar (figura~\ref{fig:bodeMatlabSinComp}), se determina la frecuencia en la que el margen de fase alcanza el valor deseado de $60^\circ$.
\insertarfigura{./img/C1_K/analisisK}{Análisis de la ganancia de la planta.}{fig:AnalK}{1}
Como se aprecia en la figura~\ref{fig:AnalK}, la frecuencia correspondiente a un margen de fase de $60^\circ$ es de aproximadamente \SI{344}{Hz}. El margen de ganancia en dicha frecuencia es de \SI{16.9}{dB}. De este modo, si se incrementa la ganancia en ese valor, es posible forzar el cruce de tal manera que se alcance el margen de fase requerido:
\[
20\log(K) = MG_{\text{inicial}} - MG_{\text{deseado}}.
\]
Dado que $MG_{\text{inicial}} - MG_{\text{deseado}} = 16.9$, la nueva ganancia es aproximadamente:
\[
K \approx 7.
\]
Con esta ganancia se obtienen los siguientes resultados:
\begin{itemize}
	\item \textbf{Margen de ganancia:} $GM = \SI{14.47}{dB}$
	\item \textbf{Margen de fase:} $PM = 60.28^\circ$
	\item \textbf{Frecuencia de cruce de ganancia:} $\omega_{cg} = 1.2 \times 10^3$
	\item \textbf{Frecuencia de cruce de fase:} $\omega_{cp} = 344$
\end{itemize}

\insertarfigura{./img/C1_K/esfuerzoC1}{Esfuerzo de control con el compensador proporcional.}{fig:esfuerzoC1K}{1}

\insertarfigura{./img/C1_K/stepC1}{Respuesta al escalón con el compensador proporcional.}{fig:stepC1K}{1}

Con la nueva ganancia $K$ se calcula el error en estado estacionario:
\[
e \approx \frac{1}{1+K_p} \approx 0.125 \;\; \Rightarrow \;\; 12.5\%.
\]

Este error es considerablemente menor al obtenido con el primer compensador. Sin embargo, la respuesta presenta un \emph{overshoot} más pronunciado, lo que se traduce en esfuerzos de control abruptos al inicio, como puede observarse en la figura~\ref{fig:esfuerzoC1K}. Esto provoca la saturación del VDAC incluso con escalones pequeños.  

Por lo tanto, se concluye que este segundo diseño tampoco constituye una solución óptima.

\subsubsection{El compensador debe permitir el seguimiento de una entrada rampa con un error en estado estable igual a $1/K_v$}

Para cumplir con este requerimiento, es necesario diseñar un compensador que incorpore un polo en el origen. De esta forma, el sistema podrá alcanzar un error en estado estacionario finito frente a una entrada rampa.  

Los márgenes iniciales obtenidos con este compensador se muestran en la figura~\ref{fig:margIniC2}.  

\insertarfigura{./img/C2/margenInicio}{Diagrama de Bode con Margen de Ganancia inicial.}{fig:margIniC2}{1}

Como criterio de diseño, se establece un margen de ganancia deseada es de \SI{10}{dB}. Por lo tanto, se debe determinar el valor de la ganancia $K$ que cumpla con esta condición.

\insertarfigura{./img/C2/margenPosK}{Diagrama de Bode nuevo de margen de ganancia (GM).}{fig:margenPosK}{1}

Con el nuevo margen de ganancia se obtienen los siguientes valores a partir de la figura~\ref{fig:margenPosK}:
\begin{itemize}
	\item \textbf{Ganancia:} $K = 158.932$
	\item \textbf{Margen de ganancia:} $GM = \SI{10}{dB}$
	\item \textbf{Margen de fase:} $PM = 22.56^\circ$
	\item \textbf{Frecuencia de cruce de ganancia:} $\omega_{cg} = 160$
	\item \textbf{Frecuencia de cruce de fase:} $\omega_{cp} = 85.7$
\end{itemize}

Se observa que el margen de fase obtenido es de $22.56^\circ$, por lo que para alcanzar el criterio de $60^\circ$ aún faltan aproximadamente $37.44^\circ$. En consecuencia, se incorpora un compensador de adelanto (Lead) con el objetivo de aportar la fase adicional requerida.

\insertarfigura{./img/C2/margenConCompensador}{Diagrama de Bode del Compensador - Etapa Lead.}{fig:margenConCompensador2}{1}



