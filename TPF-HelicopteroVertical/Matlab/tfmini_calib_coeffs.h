/* Auto-generated by tfmini_plus_calibrate_v2.m */
/* Best model: C01_base_d */
/* Formula: Delta ~ 1 + d */
#ifndef TFMINI_CALIB_COEFFS_H
#define TFMINI_CALIB_COEFFS_H

#include <stdint.h>
#include <math.h>

/* Coefficients (float) */
#define TFMC_INTERCEPT (1008f)
#define TFMC_ (-1f)

/* Compact LUT log10(strength) with linear interpolation.
   Size: 1024. strength in [0..65535], clamp 0->1.
*/
static const float TFMC_LOG10_LUT[1024] = {
    0f, 1.80618f, 2.10721f, 2.2833f, 2.40824f, 2.50515f, 2.58433f, 2.65128f, 
    2.70927f, 2.76118f, 2.80686f, 2.84819f, 2.88593f, 2.92064f, 2.95279f, 2.98272f, 
    3.01072f, 3.03703f, 3.06183f, 3.08529f, 3.10755f, 3.12872f, 3.14891f, 3.1682f, 
    3.18667f, 3.20466f, 3.22167f, 3.23805f, 3.25382f, 3.26905f, 3.28375f, 3.29798f, 
    3.31175f, 3.3251f, 3.33806f, 3.35064f, 3.36286f, 3.37475f, 3.38632f, 3.39759f, 
    3.40858f, 3.41946f, 3.42991f, 3.44012f, 3.4501f, 3.45984f, 3.46938f, 3.47871f, 
    3.48785f, 3.49679f, 3.50556f, 3.51415f, 3.52257f, 3.53084f, 3.53895f, 3.54691f, 
    3.55473f, 3.56253f, 3.57008f, 3.57749f, 3.58478f, 3.59195f, 3.59901f, 3.60595f, 
    3.61278f, 3.61951f, 3.62613f, 3.63266f, 3.63909f, 3.64542f, 3.65167f, 3.65782f, 
    3.66389f, 3.66987f, 3.67587f, 3.68169f, 3.68744f, 3.69311f, 3.69871f, 3.70424f, 
    3.70969f, 3.71508f, 3.72041f, 3.72567f, 3.73086f, 3.736f, 3.74107f, 3.74609f, 
    3.75105f, 3.75595f, 3.76087f, 3.76567f, 3.77041f, 3.7751f, 3.77974f, 3.78433f, 
    3.78888f, 3.79337f, 3.79782f, 3.80223f, 3.80659f, 3.8109f, 3.81518f, 3.81941f, 
    3.8236f, 3.82776f, 3.83193f, 3.83601f, 3.84004f, 3.84404f, 3.848f, 3.85193f, 
    3.85582f, 3.85968f, 3.8635f, 3.86729f, 3.87105f, 3.87477f, 3.87846f, 3.88213f, 
    3.88576f, 3.88936f, 3.89298f, 3.89653f, 3.90004f, 3.90352f, 3.90698f, 3.91041f, 
    3.91381f, 3.91719f, 3.92054f, 3.92387f, 3.92717f, 3.93044f, 3.93369f, 3.93692f, 
    3.94012f, 3.9433f, 3.94645f, 3.94963f, 3.95274f, 3.95583f, 3.9589f, 3.96194f, 
    3.96497f, 3.96797f, 3.97095f, 3.97391f, 3.97685f, 3.97978f, 3.98268f, 3.98556f, 
    3.98843f, 3.99127f, 3.9941f, 3.99695f, 3.99974f, 4.00251f, 4.00527f, 4.008f, 
    4.01072f, 4.01343f, 4.01611f, 4.01878f, 4.02144f, 4.02408f, 4.0267f, 4.0293f, 
    4.03189f, 4.03447f, 4.03703f, 4.03961f, 4.04214f, 4.04466f, 4.04716f, 4.04964f, 
    4.05212f, 4.05457f, 4.05702f, 4.05945f, 4.06187f, 4.06427f, 4.06666f, 4.06904f, 
    4.0714f, 4.07375f, 4.07609f, 4.07846f, 4.08077f, 4.08307f, 4.08536f, 4.08764f, 
    4.08991f, 4.09216f, 4.0944f, 4.09663f, 4.09885f, 4.10106f, 4.10326f, 4.10544f, 
    4.10762f, 4.10978f, 4.11193f, 4.11411f, 4.11624f, 4.11836f, 4.12048f, 4.12258f, 
    4.12467f, 4.12675f, 4.12882f, 4.13088f, 4.13293f, 4.13497f, 4.13701f, 4.13903f, 
    4.14104f, 4.14305f, 4.14504f, 4.14703f, 4.14903f, 4.151f, 4.15296f, 4.15491f, 
    4.15685f, 4.15878f, 4.16071f, 4.16262f, 4.16453f, 4.16643f, 4.16832f, 4.1702f, 
    4.17208f, 4.17394f, 4.1758f, 4.17765f, 4.17952f, 4.18136f, 4.18318f, 4.185f, 
    4.18682f, 4.18862f, 4.19042f, 4.1922f, 4.19399f, 4.19576f, 4.19753f, 4.19929f, 
    4.20104f, 4.20279f, 4.20453f, 4.20626f, 4.20801f, 4.20973f, 4.21144f, 4.21315f, 
    4.21484f, 4.21654f, 4.21822f, 4.2199f, 4.22157f, 4.22324f, 4.2249f, 4.22655f, 
    4.2282f, 4.22984f, 4.23147f, 4.2331f, 4.23475f, 4.23636f, 4.23797f, 4.23957f, 
    4.24117f, 4.24276f, 4.24435f, 4.24593f, 4.24751f, 4.24908f, 4.25064f, 4.2522f, 
    4.25375f, 4.2553f, 4.25684f, 4.25837f, 4.2599f, 4.26145f, 4.26297f, 4.26449f, 
    4.266f, 4.2675f, 4.269f, 4.27049f, 4.27198f, 4.27346f, 4.27494f, 4.27642f, 
    4.27788f, 4.27935f, 4.28081f, 4.28226f, 4.28371f, 4.28517f, 4.28661f, 4.28805f, 
    4.28948f, 4.2909f, 4.29232f, 4.29374f, 4.29515f, 4.29656f, 4.29796f, 4.29935f, 
    4.30075f, 4.30214f, 4.30352f, 4.3049f, 4.30627f, 4.30767f, 4.30903f, 4.3104f, 
    4.31175f, 4.31311f, 4.31446f, 4.3158f, 4.31714f, 4.31848f, 4.31981f, 4.32114f, 
    4.32247f, 4.32379f, 4.32511f, 4.32642f, 4.32773f, 4.32905f, 4.33035f, 4.33165f, 
    4.33294f, 4.33423f, 4.33552f, 4.3368f, 4.33808f, 4.33935f, 4.34062f, 4.34189f, 
    4.34315f, 4.34441f, 4.34567f, 4.34692f, 4.34817f, 4.34941f, 4.35067f, 4.35191f, 
    4.35315f, 4.35438f, 4.3556f, 4.35683f, 4.35805f, 4.35927f, 4.36048f, 4.36169f, 
    4.3629f, 4.3641f, 4.3653f, 4.3665f, 4.36769f, 4.36888f, 4.37009f, 4.37127f, 
    4.37245f, 4.37363f, 4.3748f, 4.37597f, 4.37714f, 4.37831f, 4.37947f, 4.38063f, 
    4.38178f, 4.38294f, 4.38408f, 4.38523f, 4.38637f, 4.38751f, 4.38867f, 4.3898f, 
    4.39093f, 4.39206f, 4.39319f, 4.39431f, 4.39543f, 4.39655f, 4.39766f, 4.39877f, 
    4.39988f, 4.40099f, 4.40209f, 4.40319f, 4.40429f, 4.40538f, 4.40649f, 4.40758f, 
    4.40866f, 4.40975f, 4.41083f, 4.41191f, 4.41298f, 4.41405f, 4.41512f, 4.41619f, 
    4.41726f, 4.41832f, 4.41938f, 4.42043f, 4.42149f, 4.42254f, 4.42359f, 4.42465f, 
    4.4257f, 4.42674f, 4.42778f, 4.42881f, 4.42985f, 4.43088f, 4.43191f, 4.43294f, 
    4.43396f, 4.43498f, 4.436f, 4.43702f, 4.43804f, 4.43905f, 4.44006f, 4.44108f, 
    4.44209f, 4.44309f, 4.44409f, 4.44509f, 4.44609f, 4.44708f, 4.44807f, 4.44906f, 
    4.45005f, 4.45103f, 4.45202f, 4.453f, 4.45398f, 4.45495f, 4.45593f, 4.45691f, 
    4.45788f, 4.45885f, 4.45981f, 4.46078f, 4.46174f, 4.4627f, 4.46365f, 4.46461f, 
    4.46556f, 4.46651f, 4.46746f, 4.46841f, 4.46935f, 4.47029f, 4.47123f, 4.47219f, 
    4.47312f, 4.47406f, 4.47499f, 4.47592f, 4.47685f, 4.47777f, 4.4787f, 4.47962f, 
    4.48054f, 4.48146f, 4.48237f, 4.48329f, 4.4842f, 4.48511f, 4.48602f, 4.48693f, 
    4.48784f, 4.48875f, 4.48965f, 4.49055f, 4.49145f, 4.49234f, 4.49324f, 4.49413f, 
    4.49502f, 4.4959f, 4.49679f, 4.49768f, 4.49856f, 4.49944f, 4.50032f, 4.5012f, 
    4.50209f, 4.50296f, 4.50383f, 4.5047f, 4.50557f, 4.50644f, 4.5073f, 4.50817f, 
    4.50903f, 4.50989f, 4.51075f, 4.5116f, 4.51246f, 4.51331f, 4.51416f, 4.51501f, 
    4.51587f, 4.51672f, 4.51757f, 4.51841f, 4.51925f, 4.52009f, 4.52093f, 4.52177f, 
    4.5226f, 4.52343f, 4.52427f, 4.5251f, 4.52593f, 4.52675f, 4.52758f, 4.5284f, 
    4.52924f, 4.53006f, 4.53088f, 4.5317f, 4.53251f, 4.53333f, 4.53414f, 4.53495f, 
    4.53576f, 4.53657f, 4.53738f, 4.53818f, 4.53899f, 4.53979f, 4.54059f, 4.54139f, 
    4.5422f, 4.543f, 4.5438f, 4.54459f, 4.54538f, 4.54617f, 4.54696f, 4.54775f, 
    4.54854f, 4.54932f, 4.55011f, 4.55089f, 4.55167f, 4.55245f, 4.55323f, 4.554f, 
    4.55478f, 4.55557f, 4.55634f, 4.55711f, 4.55788f, 4.55865f, 4.55942f, 4.56018f, 
    4.56095f, 4.56171f, 4.56247f, 4.56323f, 4.56399f, 4.56475f, 4.56551f, 4.56626f, 
    4.56701f, 4.56778f, 4.56853f, 4.56928f, 4.57003f, 4.57078f, 4.57152f, 4.57227f, 
    4.57301f, 4.57375f, 4.57449f, 4.57523f, 4.57597f, 4.57671f, 4.57745f, 4.57818f, 
    4.57891f, 4.57966f, 4.58039f, 4.58112f, 4.58185f, 4.58257f, 4.5833f, 4.58403f, 
    4.58475f, 4.58547f, 4.58619f, 4.58691f, 4.58763f, 4.58835f, 4.58907f, 4.58978f, 
    4.5905f, 4.59122f, 4.59193f, 4.59264f, 4.59335f, 4.59406f, 4.59477f, 4.59547f, 
    4.59618f, 4.59688f, 4.59759f, 4.59829f, 4.59899f, 4.59969f, 4.60038f, 4.60108f, 
    4.60178f, 4.60247f, 4.60318f, 4.60387f, 4.60456f, 4.60525f, 4.60594f, 4.60663f, 
    4.60732f, 4.608f, 4.60869f, 4.60937f, 4.61005f, 4.61073f, 4.61142f, 4.61209f, 
    4.61277f, 4.61345f, 4.61414f, 4.61481f, 4.61549f, 4.61616f, 4.61683f, 4.6175f, 
    4.61817f, 4.61884f, 4.61951f, 4.62018f, 4.62084f, 4.62151f, 4.62217f, 4.62284f, 
    4.6235f, 4.62416f, 4.62483f, 4.62549f, 4.62615f, 4.6268f, 4.62746f, 4.62811f, 
    4.62877f, 4.62942f, 4.63007f, 4.63072f, 4.63137f, 4.63202f, 4.63267f, 4.63332f, 
    4.63396f, 4.63461f, 4.63526f, 4.63591f, 4.63655f, 4.63719f, 4.63783f, 4.63847f, 
    4.63911f, 4.63975f, 4.64038f, 4.64102f, 4.64165f, 4.64229f, 4.64292f, 4.64355f, 
    4.64418f, 4.64481f, 4.64544f, 4.64608f, 4.64671f, 4.64733f, 4.64796f, 4.64858f, 
    4.64921f, 4.64983f, 4.65045f, 4.65107f, 4.65169f, 4.65231f, 4.65293f, 4.65355f, 
    4.65417f, 4.65478f, 4.6554f, 4.65602f, 4.65663f, 4.65725f, 4.65786f, 4.65847f, 
    4.65908f, 4.65969f, 4.6603f, 4.6609f, 4.66151f, 4.66212f, 4.66272f, 4.66332f, 
    4.66393f, 4.66453f, 4.66513f, 4.66574f, 4.66634f, 4.66694f, 4.66754f, 4.66813f, 
    4.66873f, 4.66933f, 4.66992f, 4.67052f, 4.67111f, 4.6717f, 4.67229f, 4.67288f, 
    4.67347f, 4.67406f, 4.67465f, 4.67525f, 4.67583f, 4.67642f, 4.677f, 4.67759f, 
    4.67817f, 4.67875f, 4.67934f, 4.67992f, 4.6805f, 4.68108f, 4.68166f, 4.68224f, 
    4.68281f, 4.68339f, 4.68397f, 4.68454f, 4.68512f, 4.6857f, 4.68627f, 4.68684f, 
    4.68741f, 4.68798f, 4.68855f, 4.68912f, 4.68969f, 4.69026f, 4.69082f, 4.69139f, 
    4.69196f, 4.69252f, 4.69308f, 4.69365f, 4.69422f, 4.69478f, 4.69534f, 4.6959f, 
    4.69646f, 4.69702f, 4.69758f, 4.69814f, 4.69869f, 4.69925f, 4.6998f, 4.70036f, 
    4.70091f, 4.70146f, 4.70202f, 4.70257f, 4.70313f, 4.70368f, 4.70423f, 4.70478f, 
    4.70532f, 4.70587f, 4.70642f, 4.70696f, 4.70751f, 4.70806f, 4.7086f, 4.70914f, 
    4.70969f, 4.71023f, 4.71077f, 4.71131f, 4.71186f, 4.7124f, 4.71294f, 4.71347f, 
    4.71401f, 4.71455f, 4.71508f, 4.71562f, 4.71615f, 4.71669f, 4.71722f, 4.71775f, 
    4.71829f, 4.71882f, 4.71935f, 4.71988f, 4.72041f, 4.72094f, 4.72147f, 4.722f, 
    4.72253f, 4.72305f, 4.72358f, 4.7241f, 4.72463f, 4.72515f, 4.72567f, 4.7262f, 
    4.72672f, 4.72724f, 4.72776f, 4.72828f, 4.7288f, 4.72933f, 4.72985f, 4.73036f, 
    4.73088f, 4.7314f, 4.73191f, 4.73243f, 4.73294f, 4.73345f, 4.73397f, 4.73448f, 
    4.73499f, 4.7355f, 4.73601f, 4.73652f, 4.73703f, 4.73755f, 4.73806f, 4.73857f, 
    4.73907f, 4.73958f, 4.74009f, 4.74059f, 4.7411f, 4.7416f, 4.7421f, 4.74261f, 
    4.74311f, 4.74361f, 4.74411f, 4.74461f, 4.74511f, 4.74562f, 4.74612f, 4.74662f, 
    4.74712f, 4.74761f, 4.74811f, 4.74861f, 4.7491f, 4.7496f, 4.75009f, 4.75059f, 
    4.75108f, 4.75157f, 4.75206f, 4.75256f, 4.75305f, 4.75354f, 4.75403f, 4.75452f, 
    4.75501f, 4.7555f, 4.75599f, 4.75648f, 4.75696f, 4.75745f, 4.75793f, 4.75842f, 
    4.7589f, 4.75939f, 4.75987f, 4.76035f, 4.76084f, 4.76132f, 4.76181f, 4.76229f, 
    4.76277f, 4.76325f, 4.76373f, 4.76421f, 4.76468f, 4.76516f, 4.76564f, 4.76612f, 
    4.76659f, 4.76707f, 4.76754f, 4.76802f, 4.76849f, 4.76896f, 4.76944f, 4.76992f, 
    4.77039f, 4.77086f, 4.77133f, 4.7718f, 4.77227f, 4.77274f, 4.77321f, 4.77368f, 
    4.77414f, 4.77461f, 4.77508f, 4.77555f, 4.77601f, 4.77648f, 4.77695f, 4.77741f, 
    4.77788f, 4.77834f, 4.7788f, 4.77926f, 4.77973f, 4.78019f, 4.78065f, 4.78111f, 
    4.78157f, 4.78203f, 4.78249f, 4.78295f, 4.7834f, 4.78386f, 4.78432f, 4.78478f, 
    4.78524f, 4.78569f, 4.78615f, 4.7866f, 4.78706f, 4.78751f, 4.78796f, 4.78842f, 
    4.78887f, 4.78932f, 4.78977f, 4.79022f, 4.79067f, 4.79112f, 4.79157f, 4.79203f, 
    4.79248f, 4.79292f, 4.79337f, 4.79382f, 4.79426f, 4.79471f, 4.79516f, 4.7956f, 
    4.79605f, 4.79649f, 4.79694f, 4.79738f, 4.79782f, 4.79826f, 4.79871f, 4.79915f, 
    4.7996f, 4.80004f, 4.80048f, 4.80092f, 4.80136f, 4.80179f, 4.80223f, 4.80267f, 
    4.80311f, 4.80355f, 4.80398f, 4.80442f, 4.80485f, 4.80529f, 4.80573f, 4.80617f, 
    4.8066f, 4.80703f, 4.80747f, 4.8079f, 4.80833f, 4.80876f, 4.8092f, 4.80963f, 
    4.81006f, 4.81049f, 4.81092f, 4.81135f, 4.81178f, 4.8122f, 4.81263f, 4.81307f, 
    4.81349f, 4.81392f, 4.81435f, 4.81477f, 4.8152f, 4.81562f, 4.81605f, 4.81647f

};

static inline float tfmc_log10_strength(uint16_t strength)
{
    if(strength==0u) strength = 1u;
    const float pos = ( (float)strength ) * ( (float)(1024 - 1) / 65535.0f );
    int32_t i = (int32_t)pos;
    if(i < 0) i = 0;
    if(i >= 1024-1) return TFMC_LOG10_LUT[1024-1];
    const float t = pos - (float)i;
    return TFMC_LOG10_LUT[i] + t * (TFMC_LOG10_LUT[i+1] - TFMC_LOG10_LUT[i]);
}

/* Apply correction: returns corrected distance (cm) */
static inline float tfmini_correct_distance_cm(float dis_calc_cm, uint16_t strength, float temp_c, float freq_hz)
{
    const float d = dis_calc_cm;
    const float T = temp_c;
    const float S = (float)strength;
    const float x = tfmc_log10_strength(strength);
    if(freq_hz < 0.1f) freq_hz = 0.1f;
    const float y = log10f(freq_hz);
    float Delta = 0.0f;
    Delta += TFMC_INTERCEPT;
    Delta += TFMC_ * (d);
    return d + Delta;
}

#endif /* TFMINI_CALIB_COEFFS_H */
